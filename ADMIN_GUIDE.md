# 管理后台使用指南

## 🎯 功能概述

管理后台提供完整的患者数据可视化管理功能，包括：
- ✅ 查看所有患者列表
- ✅ 搜索患者（按姓名、邮箱、电话）
- ✅ 添加新患者
- ✅ 编辑患者信息
- ✅ 删除患者

## 🔐 访问管理后台

### 1. 访问地址
```
http://localhost:3000/admin
```

### 2. 默认管理员账号
```
用户名：admin
密码：admin123
```

⚠️ **安全提示**：部署到生产环境前，请修改默认密码！

## 📊 功能详解

### 1. 患者列表查看

登录后，您将看到：
- 📋 所有患者的表格视图
- 📊 患者总数统计
- 🔍 实时搜索框

**表格列**：
| 列名 | 说明 |
|------|------|
| ID | 患者唯一标识 |
| 姓名 | 患者姓名 |
| 邮箱 | 登录验证用 |
| 电话 | 登录验证用 |
| 年龄 | 患者年龄 |
| 性别 | 男/女 |
| 职业 | 患者职业 |
| 操作 | 编辑/删除按钮 |

### 2. 搜索功能

在搜索框中输入关键词，支持搜索：
- 患者姓名
- 邮箱地址
- 电话号码

实时过滤，无需点击搜索按钮。

### 3. 添加患者

**步骤**：
1. 点击右上角 "➕ 添加患者" 按钮
2. 填写患者信息：
   - **必填项**：姓名、邮箱、电话
   - **选填项**：年龄、性别、身份证、职业、地址、病史
3. 点击 "保存" 按钮

**示例数据**：
```
姓名：李华
邮箱：lihua@example.com
电话：+852 9888 7777
年龄：35
性别：男
身份证：A123456(7)
职业：医生
地址：香港中环金融街1号
病史：无特殊病史
```

### 4. 编辑患者

**步骤**：
1. 在患者列表中找到要编辑的患者
2. 点击 "✏️ 编辑" 按钮
3. 修改信息
4. 点击 "保存" 按钮

### 5. 删除患者

**步骤**：
1. 在患者列表中找到要删除的患者
2. 点击 "🗑️ 删除" 按钮
3. 确认删除操作

⚠️ **警告**：删除操作不可撤销！

## 🔧 技术实现

### 数据存储

**本地开发**：
- 数据存储在 `lib/db-mock.ts`
- 修改会保存在内存中（重启服务器后重置）

**生产环境**：
- 数据存储在 Vercel Postgres 数据库
- 修改会永久保存

### API 端点

**GET** `/api/admin/patients`
- 获取所有患者列表

**POST** `/api/admin/patients`
- 添加新患者
- 请求体：患者信息对象

**PUT** `/api/admin/patients`
- 更新患者信息
- 请求体：包含 id 的患者信息对象

**DELETE** `/api/admin/patients`
- 删除患者
- 请求体：`{ id: "患者ID" }`

### 身份验证

目前使用简单的 localStorage 存储登录状态：
```javascript
localStorage.setItem('admin_session', 'true')
```

⚠️ **生产环境建议**：
- 使用 JWT Token
- 使用 NextAuth.js
- 添加 CSRF 保护
- 使用 HTTPS

## 📱 响应式设计

管理后台支持：
- 💻 桌面端（推荐）
- 📱 平板端
- 📱 移动端（功能完整，但推荐在大屏幕使用）

## 🎨 界面特性

- 🌈 现代化渐变设计
- ✨ 平滑动画效果
- 🎯 清晰的视觉层次
- 💡 直观的操作反馈
- 🚀 快速响应

## 🔒 安全建议

### 开发环境
✅ 当前实现已足够

### 生产环境
需要额外实现：

1. **强密码策略**
   ```typescript
   // 使用 bcrypt 加密密码
   import bcrypt from 'bcrypt'
   const hashedPassword = await bcrypt.hash(password, 10)
   ```

2. **Session 管理**
   ```typescript
   // 使用 JWT Token
   import jwt from 'jsonwebtoken'
   const token = jwt.sign({ userId: admin.id }, SECRET_KEY)
   ```

3. **API 权限验证**
   ```typescript
   // 在 API 中验证管理员身份
   if (!isAdmin(req)) {
     return res.status(403).json({ error: 'Forbidden' })
   }
   ```

4. **HTTPS 强制**
   - Vercel 自动启用 HTTPS ✅

5. **速率限制**
   ```typescript
   // 防止暴力破解
   import rateLimit from 'express-rate-limit'
   ```

## 🐛 常见问题

### Q: 刷新页面后退出登录了
**A**: 这是正常的（本地开发）。localStorage 在某些浏览器设置下可能被清除。生产环境建议使用 Cookie + JWT。

### Q: 添加患者后列表没更新
**A**: 检查浏览器 Console 是否有错误。如果是数据库连接问题，确保 Vercel Postgres 已正确配置。

### Q: 删除患者后还能用该账号登录吗
**A**: 不能。删除后该患者将无法通过邮箱+电话验证登录。

### Q: 本地开发时的修改会保存吗
**A**: 不会。本地使用内存数据，重启服务器后恢复初始数据。部署到 Vercel 后修改会永久保存。

## 📊 数据字段说明

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| name | string | ✅ | 患者姓名 | 陈大文 |
| email | string | ✅ | 邮箱（用于登录） | chen@example.com |
| phone | string | ✅ | 电话（用于登录） | +852 9123 4567 |
| age | number | - | 年龄 | 45 |
| gender | string | - | 性别 | 男/女 |
| id_card | string | - | 香港身份证 | H123456(7) |
| address | string | - | 居住地址 | 香港九龍... |
| occupation | string | - | 职业 | 金融分析師 |
| medical_history | string | - | 病史记录 | 高血壓病史5年... |

## 🎯 使用场景

### 场景 1：批量添加患者
1. 准备好患者数据（Excel/CSV）
2. 逐个通过 "添加患者" 功能录入
3. 或者直接在数据库中批量导入

### 场景 2：更新患者信息
1. 患者病情变化时
2. 患者联系方式更新时
3. 使用 "编辑" 功能快速更新

### 场景 3：查询患者
1. 使用搜索框快速定位
2. 查看完整信息
3. 可导出数据（功能待开发）

### 场景 4：清理测试数据
1. 使用 "删除" 功能
2. 删除不需要的测试账号
3. 保持数据库整洁

## 📝 下一步优化建议

1. **数据导出** - 导出为 Excel/CSV
2. **数据导入** - 批量导入功能
3. **操作日志** - 记录所有增删改操作
4. **数据统计** - 患者年龄分布、病史统计等
5. **权限管理** - 多级管理员权限
6. **数据备份** - 自动备份功能

---

**当前版本**：v1.0  
**最后更新**：2025-10-10

